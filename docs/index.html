<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>TV DO BILL</title>
<link href="https://vjs.zencdn.net/7.20.2/video-js.css" rel="stylesheet" />
<style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background-color: #000; color: #fff; display: flex; flex-direction: column; height: 100vh; }
    #container { display: flex; flex-direction: column; height: 100%; }
    #header { background-color: rgba(0, 128, 0, 0.8); padding: 10px; text-align: center; font-size: 1.1em; border-bottom: 1px solid #ffcc00; }
    #main { display: flex; flex: 1; overflow: hidden; }
    #sidebar { flex: 1; background-color: rgba(34,34,34,0.8); overflow-y: auto; padding: 10px; border-left: 2px solid #ffcc00; }
    #search-bar { padding: 10px; background-color: #333; }
    #search-input { width: 95%; padding: 10px; border: none; border-radius: 5px; font-size: 1em; }
    #lista-canais { list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 10px; }
    #lista-canais li { background-color: rgba(50, 50, 50, 0.8); border-radius: 8px; padding: 10px; display: flex; align-items: center; cursor: pointer; }
    #lista-canais li:hover { background-color: #ffcc00; }
    #lista-canais img { width: 50px; height: 50px; margin-right: 10px; border-radius: 50%; border: 2px solid #ffcc00; background: #fff; object-fit: cover; }
    #lista-canais p { margin: 0; font-size: 1em; }
    #player { flex: 2; background-color: black; display: flex; justify-content: center; align-items: center; }
    .video-js { width: 100% !important; height: 100% !important; }
    ::-webkit-scrollbar { width: 10px; }
    ::-webkit-scrollbar-thumb { background-color: #ffcc00; border-radius: 10px; }
</style>
</head>
<body>
<div id="container">
    <div id="header">
        TV DO BILL - LISTA IPTV: https://bit.ly/bill-iptv - EPG: https://bit.ly/tvdobill-epg
    </div>
    <div id="main">
        <div id="sidebar">
            <div id="search-bar">
                <input type="text" id="search-input" placeholder="Buscar canal..." />
            </div>
            <ul id="lista-canais"></ul>
        </div>
        <div id="player">
            <video id="video-player" class="video-js vjs-default-skin" controls></video>
        </div>
    </div>
</div>

<script src="https://vjs.zencdn.net/7.20.2/video.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {
    var listaURL = "https://raw.githubusercontent.com/listadobill/tv/refs/heads/main/zteste.m3u";
    var listaCanaisElemento = document.getElementById("lista-canais");
    var searchInput = document.getElementById("search-input");
    var video = videojs("video-player", { controls: true, autoplay: false, preload: "auto", fluid: true });

    // Função para carregar M3U usando XMLHttpRequest (compatível com TVs antigas)
    function carregarLista(callback) {
        var xhr = new XMLHttpRequest();
        xhr.open("GET", listaURL, true);
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200) {
                callback(xhr.responseText);
            }
        };
        xhr.send();
    }

    carregarLista(function (data) {
        var linhas = data.split("\n");
        var canais = [];

        for (var i = 0; i < linhas.length; i++) {
            if (linhas[i].indexOf("#EXTINF") === 0) {
                var logoMatch = linhas[i].match(/tvg-logo="([^"]*)"/);
                var logo = logoMatch ? logoMatch[1] : "";
                var nome = linhas[i].split(",").pop().trim();
                var url = linhas[i + 1] ? linhas[i + 1].trim() : "";
                if (url.indexOf("http") === 0) {
                    canais.push({ name: nome, url: url, logo: logo });
                }
            }
        }

        canais.sort(function (a, b) { return a.name.localeCompare(b.name, 'pt-BR'); });

        function renderizar(lista) {
            listaCanaisElemento.innerHTML = "";
            lista.forEach(function (canal) {
                var li = document.createElement("li");

                // Coloca logo genérica até carregar a real
                var img = document.createElement("img");
                img.src = "https://via.placeholder.com/50"; 
                img.dataset.src = canal.logo; // logo real

                var p = document.createElement("p");
                p.textContent = canal.name;

                li.appendChild(img);
                li.appendChild(p);

                li.addEventListener("click", function () {
                    video.src({ type: "application/x-mpegURL", src: canal.url });
                    video.play();
                });

                listaCanaisElemento.appendChild(li);
            });

            // Lazy load das logos (somente depois que a lista é mostrada)
            setTimeout(function () {
                var imgs = document.querySelectorAll("#lista-canais img");
                imgs.forEach(function (el) {
                    if (el.dataset.src) el.src = el.dataset.src;
                });
            }, 500);
        }

        renderizar(canais);

        searchInput.addEventListener("input", function () {
            var filtro = searchInput.value.toLowerCase();
            var filtrados = canais.filter(function (c) {
                return c.name.toLowerCase().indexOf(filtro) > -1;
            });
            renderizar(filtrados);
        });
    });
});
</script>
</body>
</html>
