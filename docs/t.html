<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TV DO BILL</title>
<style>
body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background: #000;
    color: #fff;
    display: flex;
    height: 100vh;
    overflow: hidden;
}

#container {
    display: flex;
    width: 100%;
    height: 100%;
}

#sidebar {
    width: 30%;
    max-width: 350px;
    background: #222;
    overflow-y: auto;
    padding: 10px;
    border-right: 2px solid #600;
}

#search-bar {
    padding: 10px;
    margin-bottom: 10px;
}

#search-input {
    width: 100%;
    padding: 10px;
    border: none;
    border-radius: 4px;
    font-size: 16px;
    background: #333;
    color: #fff;
}

#lista-canais {
    list-style: none;
    padding: 0;
    margin: 0;
}

#lista-canais li {
    padding: 12px;
    margin-bottom: 5px;
    background: #333;
    border-radius: 4px;
    cursor: pointer;
}

#lista-canais li:hover, #lista-canais li.active {
    background: #900;
}

#player {
    flex: 1;
    background: #000;
    display: flex;
    justify-content: center;
    align-items: center;
}

#video-player {
    width: 100%;
    height: 100%;
    background: #000;
}

#loading {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

.loading-text {
    color: white;
    font-size: 20px;
    margin-top: 20px;
}

#error-message {
    display: none;
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: #900;
    padding: 10px 20px;
    border-radius: 5px;
    z-index: 1000;
    max-width: 80%;
    text-align: center;
}
</style>
</head>
<body>
<div id="container">
    <div id="sidebar">
        <div id="search-bar">
            <input type="text" id="search-input" placeholder="Buscar canal...">
        </div>
        <ul id="lista-canais"></ul>
    </div>
    <div id="player">
        <video id="video-player" controls playsinline></video>
    </div>
</div>

<div id="loading">
    <div>
        <div style="width:50px;height:50px;border:5px solid #333;border-top:5px solid #900;border-radius:50%;animation:spin 1s linear infinite;margin:0 auto;"></div>
        <div class="loading-text">Carregando canais...</div>
    </div>
</div>

<div id="error-message"></div>

<script>
// Função simples para mostrar/ocultar loading
function showLoading() {
    document.getElementById('loading').style.display = 'flex';
}

function hideLoading() {
    document.getElementById('loading').style.display = 'none';
}

// Função para mostrar erro
function showError(message) {
    var errorElement = document.getElementById('error-message');
    errorElement.textContent = message;
    errorElement.style.display = 'block';
    setTimeout(function() {
        errorElement.style.display = 'none';
    }, 5000);
}

// Carregar lista de canais
function loadChannels() {
    showLoading();
    
    // URL da lista de canais com proxy CORS simples
    var listaURL = "https://corsproxy.io/?https://raw.githubusercontent.com/listadobill/tv/main/servidor1.m3u";
    
    // Fazer requisição simples usando XMLHttpRequest (mais compatível)
    var xhr = new XMLHttpRequest();
    xhr.open('GET', listaURL, true);
    xhr.onreadystatechange = function() {
        if (xhr.readyState === 4) {
            if (xhr.status === 200) {
                processChannels(xhr.responseText);
                hideLoading();
            } else {
                showError("Erro ao carregar canais. Tentando novamente...");
                setTimeout(loadChannels, 3000); // Tentar novamente após 3 segundos
            }
        }
    };
    xhr.send();
}

// Processar lista de canais
function processChannels(data) {
    var linhas = data.split('\n');
    var canais = [];
    
    for (var i = 0; i < linhas.length; i++) {
        if (linhas[i].startsWith('#EXTINF')) {
            var nome = linhas[i].split(',')[1] || "Sem nome";
            var url = linhas[i + 1];
            if (url && (url.startsWith("http://") || url.startsWith("https://"))) {
                canais.push({ name: nome.trim(), url: url });
            }
        }
    }
    
    // Ordenar canais por nome
    canais.sort(function(a, b) {
        return a.name.localeCompare(b.name);
    });
    
    renderChannels(canais);
    
    // Reproduzir o primeiro canal se disponível
    if (canais.length > 0) {
        playChannel(canais[0]);
    }
}

// Renderizar lista de canais
function renderChannels(canais) {
    var listaElemento = document.getElementById('lista-canais');
    listaElemento.innerHTML = '';
    
    // Filtrar canais se houver busca
    var searchText = document.getElementById('search-input').value.toLowerCase();
    var canaisFiltrados = canais;
    
    if (searchText) {
        canaisFiltrados = canais.filter(function(canal) {
            return canal.name.toLowerCase().includes(searchText);
        });
    }
    
    // Adicionar canais à lista
    canaisFiltrados.forEach(function(canal) {
        var li = document.createElement('li');
        li.textContent = canal.name;
        li.onclick = function() {
            playChannel(canal);
            // Destacar canal selecionado
            var itens = listaElemento.getElementsByTagName('li');
            for (var j = 0; j < itens.length; j++) {
                itens[j].className = '';
            }
            li.className = 'active';
        };
        listaElemento.appendChild(li);
    });
}

// Reproduzir canal
function playChannel(canal) {
    var video = document.getElementById('video-player');
    
    // Tentar detectar se é HLS para Smart TVs
    if (canal.url.includes('.m3u8') && typeof Hls !== 'undefined') {
        if (Hls.isSupported()) {
            var hls = new Hls();
            hls.loadSource(canal.url);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, function() {
                video.play();
            });
        } else {
            // Fallback para player nativo
            video.src = canal.url;
            video.play();
        }
    } else {
        // Para outros formatos
        video.src = canal.url;
        video.play();
    }
    
    video.onerror = function() {
        showError("Erro ao carregar o canal. Tente outro.");
    };
}

// Inicializar quando a página carregar
document.addEventListener('DOMContentLoaded', function() {
    // Configurar busca
    document.getElementById('search-input').addEventListener('input', function() {
        loadChannels(); // Recarregar a lista filtrada
    });
    
    // Carregar canais
    loadChannels();
    
    // Carregar Hls.js apenas se necessário (para streams HLS)
    var script = document.createElement('script');
    script.src = 'https://cdn.jsdelivr.net/npm/hls.js@latest';
    document.head.appendChild(script);
});

// Animation para o loading
document.head.appendChild(document.createElement('style')).textContent = '@keyframes spin {0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}';
</script>
</body>
</html>
