<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="IPTV Player">
    <meta name="author" content="NodeTent">
    <title>IPTV Player</title>
    <!-- Video.js CSS -->
    <link href="https://vjs.zencdn.net/7.20.3/video-js.css" rel="stylesheet">
    <!-- Bootstrap core CSS-->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        #player {
            margin-top: 10px;
        }
        #channel-list {
            max-height: 600px;
            overflow-y: auto;
        }
        .channel {
            cursor: pointer;
        }
        .channel:hover {
            background-color: #e2e6ea;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand navbar-light bg-white static-top sticky-top">
        <span class="navbar-brand">IPTV Player</span>
    </nav>
    <div class="container mt-3">
        <div class="row">
            <div class="col-lg-4">
                <h5>Canais</h5>
                <ul id="channel-list" class="navbar-nav list-group">
                    <!-- A lista será populada dinamicamente -->
                </ul>
            </div>
            <div class="col-lg-8">
                <video
                    id="video-player"
                    class="video-js vjs-default-skin"
                    controls
                    preload="auto"
                    width="100%"
                    height="500px">
                    <source id="video-source" src="" type="application/x-mpegURL">
                    <p class="vjs-no-js">
                        Para ver este vídeo, ative o JavaScript e considere a atualização para um navegador da web que
                        <a href="https://www.google.com/chrome/">suporte JavaScript</a>
                    </p>
                </video>
            </div>
        </div>
    </div>

    <!-- Video.js JavaScript -->
    <script src="https://vjs.zencdn.net/7.20.3/video.min.js"></script>
    <script>
        // URL da lista M3U
        const playlistUrl = "https://raw.githubusercontent.com/listadobill/tv/refs/heads/main/listadecanais.m3u";

        // Função para carregar e parsear a lista M3U
        async function loadM3U() {
            try {
                const response = await fetch(playlistUrl);
                const text = await response.text();
                const channels = parseM3U(text);
                displayChannels(channels);
            } catch (error) {
                console.error('Erro ao carregar a lista M3U:', error);
            }
        }

        // Função para parsear a lista M3U e extrair URLs
        function parseM3U(m3uText) {
            const lines = m3uText.split('\n');
            const channels = [];
            let currentChannel = {};

            lines.forEach(line => {
                line = line.trim();
                if (line.startsWith("#EXTINF")) {
                    const name = line.split(',')[1].trim();
                    currentChannel = { name };
                } else if (line && !line.startsWith('#')) {
                    currentChannel.url = line;
                    channels.push(currentChannel);
                    currentChannel = {};
                }
            });
            return channels;
        }

        // Função para exibir a lista de canais
        function displayChannels(channels) {
            const channelList = document.getElementById('channel-list');
            channels.forEach(channel => {
                const li = document.createElement('li');
                li.classList.add('nav-item');
                li.innerHTML = `
                    <a class="channel nav-link" data-value="${channel.url}" href="javascript:void(0);" onclick="playChannel('${channel.url}')">
                        ${channel.name}
                    </a>
                `;
                channelList.appendChild(li);
            });
        }

        // Função para iniciar a reprodução de um canal
        function playChannel(url) {
            console.log("Reproduzindo canal:", url); // Mensagem de depuração
            const videoSource = document.getElementById('video-source');
            videoSource.src = url; // Define a URL do canal
            const player = videojs('video-player'); // Inicializa o player
            player.load(); // Carrega a nova fonte
            player.play(); // Inicia a reprodução
        }

        // Carrega a lista de canais quando a página é carregada
        loadM3U();
    </script>
</body>
</html>
