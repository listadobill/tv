<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TV DO BILL</title>
<link href="https://vjs.zencdn.net/7.20.2/video-js.css" rel="stylesheet">
<style>
body {
  font-family: Arial, sans-serif;
  margin:0;
  padding:0;
  background:#000;
  color:#fff;
  display:flex;
  flex-direction:column;
  height:100vh;
  overflow:hidden;
}
#container {
  display:flex;
  flex-direction:column;
  width:100%;
  height:100%;
}
#main {
  display:flex;
  flex:1;
  min-height:0; /* importante para scroll funcionar na TV */
}
#player {
  flex:2;
  background:rgba(0,0,0,0.85);
  display:flex;
  justify-content:center;
  align-items:center;
  overflow:hidden;
  min-width:0;
}
.video-js {
  width:100% !important;
  height:100% !important;
  background:#000;
}
/* Video.js - manter skin padrão, barra maior e neon */
.video-js .vjs-control-bar {
  height:50px !important;
  background-color: rgba(0,0,0,0.85);
}
.video-js .vjs-control,
.video-js .vjs-play-control,
.video-js .vjs-volume-panel,
.video-js .vjs-fullscreen-control {
  width:50px !important;
  height:50px !important;
  line-height:50px !important;
  font-size:22px !important;
  color:#fff;
}
.video-js .vjs-control:hover,
.video-js .vjs-control:focus {
  color:#00f3ff !important;
  text-shadow:0 0 6px #00f3ff;
}
/* Sidebar e lista de canais */
#sidebar {
  flex:1;
  flex-shrink:0; /* evita desaparecer */
  min-width:200px;
  background:rgba(20,20,20,0.85);
  overflow-y:auto;
  padding:10px;
  border-left:2px solid #00f3ff;
}
#sidebar ul {
  list-style:none;
  padding:0;
  margin:0;
  display:flex;
  flex-direction:column;
  gap:10px;
}
#sidebar li {
  background:rgba(50,50,50,0.85);
  border-radius:6px;
  padding:10px;
  cursor:pointer;
  transition: all 0.3s ease;
}
#sidebar li:hover,
#sidebar li:focus {
  background:rgba(0,243,255,0.15);
  color:#00f3ff;
  outline:none;
  border:1px solid #00f3ff;
}
#sidebar li.active {
  background:rgba(0,243,255,0.2);
  color:#00f3ff;
  border:1px solid #00f3ff;
}
#search-bar {
  padding:10px;
  text-align:center;
  position:sticky;
  top:0;
  background:rgba(20,20,20,0.85);
  z-index:10;
}
#search-input {
  width:95%;
  padding:10px;
  border:none;
  border-radius:5px;
  font-size:1em;
  background:rgba(30,30,30,0.85);
  color:#fff;
}
#search-input:focus {
  outline:none;
  border:1px solid #00f3ff;
}
#search-input::placeholder { color: rgba(255,255,255,0.6); }
.vjs-error-display { display:none !important; }
::-webkit-scrollbar { width:12px; }
::-webkit-scrollbar-thumb { background:#00f3ff; border-radius:10px; }
</style>
</head>
<body>
<div id="container">
  <div id="main">
    <div id="player">
      <video id="video-player" class="video-js vjs-default-skin" controls playsinline></video>
    </div>
    <div id="sidebar">
      <div id="search-bar">
        <input type="text" id="search-input" placeholder="Buscar canal...">
      </div>
      <ul id="lista-canais"></ul>
    </div>
  </div>
</div>

<script src="https://vjs.zencdn.net/7.20.2/video.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function() {
  const listaURL = "https://raw.githubusercontent.com/listadobill/tv/refs/heads/main/zteste.m3u";
  const listaCanaisElemento = document.getElementById("lista-canais");
  const searchInput = document.getElementById("search-input");
  let todosCanais = [];

  const video = videojs('video-player', {
    controls: true,
    autoplay: true,
    muted: true,
    preload: 'auto',
    fluid: true,
    responsive: true
  });

  function tentarPlay() {
    video.play().then(()=>{
      if(video.muted()) video.muted(false);
    }).catch(err => console.log("Autoplay bloqueado, precisa de interação:", err));
  }

  fetch(listaURL)
    .then(r => r.text())
    .then(data => {
      const linhas = data.split('\n');
      const canais = [];
      linhas.forEach((linha,index)=>{
        if(linha.startsWith('#EXTINF')){
          const nome = linha.split(',')[1].trim();
          const url = linhas[index+1];
          canais.push({name:nome,url:url});
        }
      });
      canais.sort((a,b)=>a.name.localeCompare(b.name,'pt-BR'));
      todosCanais = canais;

      function renderizarCanais(lista, manterFoco=false){
        const elementoFocado = document.activeElement;
        const eraInput = elementoFocado === searchInput;
        listaCanaisElemento.innerHTML='';
        lista.forEach(canal=>{
          const li=document.createElement('li');
          li.tabIndex=0;
          li.textContent=canal.name;
          li.addEventListener('click', ()=>{
            video.src({type:'application/x-mpegURL',src:canal.url});
            tentarPlay();
            if(screen.width>768 && video.requestFullscreen) video.requestFullscreen();
            reconectar(canal.url);
            document.querySelectorAll('#lista-canais li').forEach(el=>el.classList.remove('active'));
            li.classList.add('active');
          });
          listaCanaisElemento.appendChild(li);
        });
        if(manterFoco && eraInput) searchInput.focus();
      }

      renderizarCanais(todosCanais);

      searchInput.addEventListener('input', ()=>{
        const filtro = searchInput.value.toLowerCase();
        const filtrados = todosCanais.filter(c=>c.name.toLowerCase().includes(filtro));
        renderizarCanais(filtrados,true);
      });

      listaCanaisElemento.addEventListener('keydown', e=>{
        const ativo=document.activeElement;
        if(ativo.tagName.toLowerCase()==='li'){
          if(e.key==='ArrowDown' && ativo.nextElementSibling){
            ativo.nextElementSibling.focus();
            ativo.nextElementSibling.scrollIntoView({behavior:'smooth',block:'nearest'});
            e.preventDefault();
          }
          if(e.key==='ArrowUp' && ativo.previousElementSibling){
            ativo.previousElementSibling.focus();
            ativo.previousElementSibling.scrollIntoView({behavior:'smooth',block:'nearest'});
            e.preventDefault();
          }
          if(e.key==='Enter'||e.key===' ') {
            ativo.click();
            e.preventDefault();
          }
        }
      });

      const primeiro = listaCanaisElemento.querySelector('li');
      if(primeiro) primeiro.focus();
    });

  function reconectar(url){
    video.src({ type:'application/x-mpegURL', src: url });
    tentarPlay();
    video.off('error');
    video.on('error',()=>setTimeout(()=>reconectar(url),5000));
  }

  video.on('ended', tentarPlay);
  video.on('pause', ()=>{ if(!video.ended()) tentarPlay(); });
  video.on('stalled', tentarPlay);
  video.on('waiting', tentarPlay);
});
</script>
</body>
</html>
