<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>IPTV Player</title>
    <link href="https://vjs.zencdn.net/7.11.4/video-js.css" rel="stylesheet">
    <script src="https://vjs.zencdn.net/7.11.4/video.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        #channelList {
            list-style-type: none;
            padding: 0;
        }
        #channelList li {
            margin: 5px 0;
            cursor: pointer;
            color: blue;
        }
        #player {
            width: 100%;
            max-width: 800px;
            margin: auto;
        }
    </style>
</head>
<body>
    <h1>IPTV Player</h1>
    <div id="player">
        <video id="videoPlayer" class="video-js vjs-default-skin" controls preload="auto" width="600" height="300" data-setup="{}">
            <source src="" type="application/x-mpegURL">
        </video>
    </div>
    <h2>Lista de Canais</h2>
    <ul id="channelList"></ul>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var videoPlayer = videojs('videoPlayer');
            var channelList = document.getElementById('channelList');

            // Função para carregar a lista M3U com CORS proxy
            function loadM3U(url) {
                fetch('https://cors-anywhere.herokuapp.com/' + url)
                    .then(response => response.text())
                    .then(data => {
                        console.log("Lista M3U carregada");
                        var lines = data.split('\n');
                        var channels = [];

                        lines.forEach((line, index) => {
                            if (line.startsWith('#EXTINF')) {
                                var name = line.split(',')[1];
                                var url = lines[index + 1];
                                channels.push({ name, url });
                            }
                        });

                        channels.forEach(channel => {
                            var li = document.createElement('li');
                            li.textContent = channel.name;
                            li.setAttribute('data-src', channel.url);
                            channelList.appendChild(li);
                        });
                    })
                    .catch(error => {
                        console.error("Erro ao carregar a lista M3U:", error);
                    });
            }

            // Adiciona evento de clique nos canais
            channelList.addEventListener('click', function(e) {
                if (e.target.tagName === 'LI') {
                    var src = e.target.getAttribute('data-src');
                    videoPlayer.src({ type: 'application/x-mpegURL', src: src });
                    videoPlayer.play();
                }
            });

            // Carrega a lista de canais do arquivo M3U
            loadM3U('https://raw.githubusercontent.com/listadobill/tv/refs/heads/main/listadecanais.m3u');
        });
    </script>
</body>
</html>
