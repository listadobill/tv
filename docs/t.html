<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Canais</title>
    <script src="https://cdn.jsdelivr.net/npm/clappr@latest/dist/clappr.min.js"></script>
    <style>
        .channel {
            cursor: pointer;
            display: block;
            margin: 5px 0;
        }
        #player {
            width: 100%;
            height: 500px;
        }
    </style>
</head>
<body>

    <div id="player"></div>
    <ul id="channelList"></ul>

    <script>
        // Usando um novo proxy CORS
        const playlistUrl = "https://api.allorigins.win/get?url=" + encodeURIComponent("http://jmrk.xyz:8880/get.php?username=scott_olson@hotmail.com&password=2p7Ks4SPxP&type=m3u");

        // Função para carregar os canais
        function loadChannels() {
            fetch(playlistUrl)
                .then(response => response.json())
                .then(data => parseM3U(data.contents))
                .catch(error => console.error('Erro ao carregar a lista M3U:', error));
        }

        // Função para analisar a lista M3U e criar links de canais
        function parseM3U(data) {
            const channels = data.split('#EXTINF:');
            const channelList = document.getElementById('channelList');
            channelList.innerHTML = ''; // Limpa a lista anterior

            channels.forEach((channel, index) => {
                if (index > 0) { // Ignora a primeira parte que não contém canais
                    const parts = channel.split('\n');
                    const channelInfo = parts[0].trim();
                    const channelUrl = parts[1].trim(); // URL do M3U

                    // Cria o elemento do canal
                    const listItem = document.createElement('li');
                    listItem.className = 'nav-item';
                    listItem.innerHTML = `<a class="channel nav-link" data-value="${channelUrl}" href="javascript:void(0);">${channelInfo}</a>`;
                    channelList.appendChild(listItem);
                    
                    // Adiciona evento de clique para carregar o canal no player
                    listItem.addEventListener('click', () => {
                        loadPlayer(channelUrl);
                    });
                }
            });
        }

        // Função para carregar o player Clappr com a URL do canal
        function loadPlayer(url) {
            const player = new Clappr.Player({
                source: url,
                parentId: '#player',
                width: '100%',
                height: '100%',
                autoPlay: true,
            });
        }

        // Carrega os canais na inicialização
        loadChannels();
    </script>

</body>
</html>
