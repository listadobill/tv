<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TV DO BILL</title>
<link href="https://vjs.zencdn.net/7.20.3/video-js.css" rel="stylesheet">
<style>
  body { margin: 0; background: #000; color: #fff; font-family: sans-serif; display: flex; height: 100vh; }
  #canal-lista { width: 30%; max-width: 280px; background: #111; overflow-y: auto; padding: 10px; }
  #canal-lista div { padding: 8px; border-bottom: 1px solid #333; cursor: pointer; background: #111; color: #fff; transition: background 0.2s, color 0.2s; }
  #canal-lista div:hover { background: #333; color: #0f0; }
  #canal-lista div.selecionado { background: #0f0; color: #000; }
  #player { flex: 1; display: flex; align-items: center; justify-content: center; background: black; position: relative; }
  #video { width: 100%; height: 100%; object-fit: contain; cursor:pointer; }
  #busca { width: 100%; padding: 8px; margin-bottom: 8px; border: none; box-sizing: border-box; }
  #reconectando { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #0f0; font-size: 22px; font-weight: bold; display: none; background: rgba(0,0,0,0.7); padding: 10px 20px; border-radius: 8px; }
</style>
</head>
<body>
<div id="canal-lista">
  <input type="text" id="busca" placeholder="üîç Buscar canal...">
  <div id="lista"></div>
</div>
<div id="player">
  <video id="video" class="video-js vjs-default-skin" controls autoplay></video>
  <div id="reconectando">Reconectando...</div>
</div>

<script src="https://vjs.zencdn.net/7.20.3/video.min.js"></script>
<script>
var player = videojs('video');
var listaCanais = [];
var canalAtual = null;
var reconectando = false;

// ---------- Fun√ß√µes utilit√°rias ----------
function abrirFullscreen() {
  var elem = document.getElementById("video");
  if (!document.fullscreenElement) {
    if (elem.requestFullscreen) elem.requestFullscreen();
    else if (elem.webkitRequestFullscreen) elem.webkitRequestFullscreen();
    else if (elem.msRequestFullscreen) elem.msRequestFullscreen();
  }
}

function sairFullscreen() {
  if (document.fullscreenElement) {
    if (document.exitFullscreen) document.exitFullscreen();
    else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
    else if (document.msExitFullscreen) document.msExitFullscreen();
  }
}

function alternarFullscreen() {
  if (document.fullscreenElement) sairFullscreen();
  else abrirFullscreen();
}

function mostrarReconectando() {
  document.getElementById('reconectando').style.display = 'block';
}

function esconderReconectando() {
  document.getElementById('reconectando').style.display = 'none';
}

// ---------- Controle de player ----------
function tocarCanal(canal) {
  reconectando = false;
  esconderReconectando();

  player.pause();
  player.src([
    { src: canal.url, type: 'application/x-mpegURL' },
    { src: canal.url.replace('.m3u8','.mp4'), type: 'video/mp4' }
  ]);
  player.play().then(abrirFullscreen).catch(() => {
    iniciarReconexao(canal);
  });
}

function iniciarReconexao(canal) {
  if (reconectando) return;
  reconectando = true;
  mostrarReconectando();

  (function tentar() {
    player.src([{ src: canal.url, type: 'application/x-mpegURL' }]);
    player.load();
    player.play()
      .then(() => {
        esconderReconectando();
        abrirFullscreen(); // garante fullscreen ap√≥s reconex√£o
        reconectando = false;
      })
      .catch(() => setTimeout(tentar, 1500));
  })();
}

// ---------- Eventos ----------
player.on('error', () => { if (canalAtual) iniciarReconexao(canalAtual); });
player.on('waiting', () => { if (canalAtual && !reconectando) iniciarReconexao(canalAtual); });

// ---------- Clique no v√≠deo para fullscreen ----------
document.getElementById("video").addEventListener("click", alternarFullscreen);

// ---------- Lista de canais ----------
function carregarLista(url) {
  fetch(url).then(r => r.text()).then(processarM3U);
}

function processarM3U(m3u) {
  var linhas = m3u.split("\n");
  var nome="", logo="", url="";
  linhas.forEach(linha => {
    linha = linha.trim();
    if(linha.startsWith("#EXTINF:")){
      var nomeMatch = linha.match(/,(.*)$/);
      var logoMatch = linha.match(/tvg-logo="(.*?)"/);
      nome = nomeMatch ? nomeMatch[1] : "Sem nome";
      logo = logoMatch ? logoMatch[1] : "";
    } else if(linha.startsWith("http")){
      url = linha;
      listaCanais.push({nome, logo, url});
    }
  });
  listaCanais.sort((a,b)=>a.nome.localeCompare(b.nome,'pt',{sensitivity:'base'}));
  mostrarCanais(listaCanais);
}

function mostrarCanais(canais) {
  var lista = document.getElementById("lista");
  lista.innerHTML = "";
  canais.forEach(canal => {
    var div = document.createElement("div");
    div.textContent = canal.nome;
    div.onclick = () => selecionarCanal(canal, div);
    lista.appendChild(div);
  });
}

function selecionarCanal(canal, el) {
  canalAtual = canal;
  tocarCanal(canal); // abre em fullscreen automaticamente
  document.querySelectorAll('#lista div').forEach(d=>d.classList.remove('selecionado'));
  el.classList.add('selecionado');
}

// ---------- Busca ----------
document.getElementById("busca").addEventListener("input", function(){
  var termo = this.value.toLowerCase();
  var filtrados = listaCanais.filter(c=>c.nome.toLowerCase().includes(termo));
  mostrarCanais(filtrados);
});

// ---------- Inicializa√ß√£o ----------
carregarLista("https://raw.githubusercontent.com/listadobill/tv/refs/heads/main/zteste.m3u");
</script>
</body>
</html>
