<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Canais</title>
    <script src="https://cdn.jsdelivr.net/npm/clappr@latest/dist/clappr.min.js"></script>
    <style>
        .channel {
            cursor: pointer;
            display: block;
            margin: 5px 0;
        }
        #player {
            width: 100%;
            height: 500px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>

    <div id="player"></div>
    <ul id="channelList"></ul>

    <script>
        // URL M3U com as credenciais
        const m3uUrl = "http://jmrk.xyz:8880/get.php?username=scott_olson@hotmail.com&password=2p7Ks4SPxP&type=m3u";

        // Função para carregar a lista M3U e processar os canais
        function loadChannels() {
            fetch(m3uUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Erro ao carregar a lista M3U: ' + response.statusText);
                    }
                    return response.text(); // Lê a resposta como texto
                })
                .then(data => {
                    parseM3U(data); // Processa a lista M3U
                })
                .catch(error => console.error('Erro ao carregar a lista de canais:', error));
        }

        // Função para analisar a lista M3U e extrair os canais
        function parseM3U(m3uData) {
            const channelList = document.getElementById('channelList');
            channelList.innerHTML = ''; // Limpa a lista anterior

            const lines = m3uData.split('\n');
            let currentChannel = {};

            lines.forEach(line => {
                line = line.trim();
                if (line.startsWith('#EXTINF:')) {
                    const channelInfo = line.split(',');
                    const channelName = channelInfo[1]; // Nome do canal
                    currentChannel = { name: channelName }; // Cria um novo objeto para o canal
                } else if (line.startsWith('http')) {
                    if (currentChannel.name) {
                        currentChannel.url = line; // Adiciona a URL do canal
                        addChannelToList(currentChannel); // Adiciona o canal à lista
                        currentChannel = {}; // Reseta o objeto para o próximo canal
                    }
                }
            });
        }

        // Função para adicionar um canal à lista HTML
        function addChannelToList(channel) {
            const channelList = document.getElementById('channelList');
            const listItem = document.createElement('li');
            listItem.className = 'nav-item';
            listItem.innerHTML = `<a class="channel nav-link" data-value="${channel.url}" href="javascript:void(0);">${channel.name}</a>`;
            channelList.appendChild(listItem);
            
            // Adiciona evento de clique para carregar o canal no player
            listItem.addEventListener('click', () => {
                loadPlayer(channel.url);
            });
        }

        // Função para carregar o player Clappr com a URL do canal
        function loadPlayer(url) {
            const player = new Clappr.Player({
                source: url,
                parentId: '#player',
                width: '100%',
                height: '100%',
                autoPlay: true,
            });
        }

        // Carrega os canais na inicialização
        loadChannels();
    </script>

</body>
</html>
